import{y as B,r as l,j as e}from"./app-f2abb593.js";import{d as W,a as v}from"./Check-22627135.js";import{M as D}from"./Modal-5dae7573.js";import E from"./ConfirmDialog-44a7c47e.js";import{u as P,r as A}from"./repairStore-14727e7a.js";import{d as L}from"./LocalShipping-87406084.js";import{u as R}from"./useMutation-202674fd.js";import{B as d}from"./Box-0b011bc2.js";import{T as m,F as U,I as $,S as z}from"./TextField-b31a34e4.js";import{A as N}from"./Autocomplete-f86b4d84.js";import{M as w}from"./MenuItem-fb7cf1cf.js";import{L as b}from"./LoadingButton-3ee33953.js";import{B as q}from"./Button-cd0730f4.js";import"./createSvgIcon-1d31149c.js";import"./createSvgIcon-59ac1e7b.js";import"./createTheme-f9f94404.js";import"./styled-3a987103.js";import"./useId-edbf73a4.js";import"./TransitionGroupContext-63f58615.js";import"./ButtonBase-032a6a52.js";import"./Modal-33f51ea5.js";import"./Container-f970a168.js";import"./styled-a73ca20e.js";import"./Typography-d8ebb2f5.js";import"./extendSxProp-2a5070d5.js";import"./vanilla-8854675d.js";import"./Menu-c9be6819.js";import"./IconButton-3ce2b7fe.js";import"./Popper-ea8f686f.js";import"./dividerClasses-9ca8f8f6.js";const G=()=>R({mutationFn:async({id:s,props:n})=>{try{const{data:i}=await axios.patch(route("repairs.update.ordered",s),n);return Promise.resolve(i)}catch(i){return Promise.reject(i.response.data.errors)}},onSuccess:()=>{B.reload({only:["repairs"]})}}),we=({repair:s})=>{const n="is_ordered_component",i=P(A),p=i.employees,S=i.groupWhereOrdered,[C,u]=l.useState(!1),[k,h]=l.useState(!1),[O,c]=l.useState(!1),[r,a]=l.useState({who_ordered_id:0,component:s.component,is_ordered_component:!1,cost:void 0,where_ordered:""}),{mutate:x,isPending:f,error:o,isSuccess:_}=G();l.useEffect(()=>{u(!!s[n])},[]),l.useEffect(()=>{_&&(c(!1),u(!C))},[_]);const M=async t=>{s[n]?h(!0):c(!0)},F=async()=>{x({id:s.id,props:{[n]:!1,who_ordered_id:0,component:"",cost:0,is_ordered_component:!1}})},j=()=>{c(!1)},I=async()=>{x({id:s.id,props:{...r,[n]:!0}})},g=()=>s.is_fixed&&s.who_ordered_id>0?1:s.who_ordered_id>0&&s.is_ordered_component&&!s.is_fixed?2:s.is_fixed&&!s.who_ordered_id?3:4,T=()=>{const t=g();return t===1?e.jsx(d,{sx:{display:"flex",flexDirection:"column",gap:1,alignItems:"center"},children:e.jsx(W,{})}):t===2?e.jsxs(d,{"aria-describedby":"block-ordered-status-open-popover",sx:{display:"flex",flexDirection:"column",gap:1,alignItems:"center"},children:[e.jsx(L,{}),s.date_ordered]}):t===3?e.jsx(e.Fragment,{children:e.jsx(v,{})}):e.jsx(v,{})};return e.jsxs(e.Fragment,{children:[e.jsx(D,{open:O,onClose:j,title:"Ordered",children:e.jsxs(d,{sx:{display:"flex",gap:5,flexDirection:"column"},children:[e.jsx(d,{children:e.jsx(m,{value:r.component||"",onChange:t=>a({...r,component:t.target.value}),sx:{width:"100%"},id:"outlined-basic",label:"Need to order",error:!!(o!=null&&o.component),helperText:o==null?void 0:o.component,variant:"outlined"})}),e.jsx(d,{children:e.jsx(m,{value:r.cost||"",type:"number",min:0,onChange:t=>a({...r,cost:t.target.value}),sx:{width:"100%"},id:"outlined-basic",label:"Cost",error:!!(o!=null&&o.cost),helperText:o==null?void 0:o.cost,variant:"outlined"})}),e.jsx(d,{children:e.jsx(N,{id:"free-solo-demo",freeSolo:!0,options:S.map(t=>t.where_ordered),renderInput:t=>e.jsx(m,{error:!!(o!=null&&o.where_ordered),helperText:o==null?void 0:o.where_ordered,value:r.where_ordered||"",onChange:y=>a({...r,where_ordered:y.target.value}),...t,label:"Where ordered"})})}),p.length&&e.jsxs(U,{fullWidth:!0,children:[e.jsx($,{id:"demo-simple-select-label",children:"Who ordered?"}),e.jsxs(z,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:r.who_ordered_id||0,label:"Who ordered?",error:!!(o!=null&&o.who_ordered_id),helperText:o==null?void 0:o.who_ordered_id,onChange:t=>a({...r,who_ordered_id:t.target.value}),children:[e.jsx(w,{disabled:!0,value:0,children:"Set employee"}),p.map((t,y)=>e.jsx(w,{value:t.id,children:t.name},t.id))]})]}),e.jsxs(d,{sx:{display:"flex",gap:3,justifyContent:"space-between"},children:[e.jsx(d,{sx:{display:"flex",gap:3},children:e.jsx(b,{color:"success",disabled:!r.who_ordered_id,loading:f,variant:"contained",onClick:I,children:"Save"})}),e.jsx(d,{children:e.jsx(q,{variant:"contained",color:"primary",onClick:j,children:"Cancel"})})]})]})}),e.jsx(E,{title:"Unmarked Picked Up?",open:k,setOpen:h,onConfirm:F,children:"Are you sure? It will be unmarked as picked up."}),e.jsx(b,{loading:f,color:g()!==4?"success":"error",size:"small",variant:"text",onClick:M,children:T()})]})};export{we as default};
